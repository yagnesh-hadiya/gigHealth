import{u as H,r as g,b as q,c as e,L as N,f as J,g as K,e as Q,R as V,h as C,k as P,l as y,m as D,br as X,d as w,bs as Y,C as L,E as Z,bt as _,H as p,bu as $,bv as ee}from"./index-e391d606.js";const le=()=>{var T,M;const{register:k,handleSubmit:R,formState:{errors:f}}=H({resolver:Z(ee)}),[G,x]=g.useState(!1),[E,O]=g.useState([]),[i,b]=g.useState([]),[U,F]=g.useState(null),v=q(),S=(s,c=null)=>i.some(l=>{var r;return c?l.module===s&&((r=l.submodules)==null?void 0:r.some(o=>o.module===c)):l.module===s}),m=({module:s,submodule:c,permission:l})=>{console.log({module:s,submodule:c,permission:l}),b(r=>{var a;const o=r.find(n=>n.module===s);if(o)if(c){const n=(a=o.submodules)==null?void 0:a.find(u=>u.module===c);if(n){const u=n.permissions.includes(l);let d=r.map(t=>{var j;return t.module===s?{...t,submodules:(j=t.submodules)==null?void 0:j.map(h=>h.module===c?{...h,permissions:u?h.permissions.filter(B=>B!==l):[...h.permissions,l]}:h)}:t});return d=d.map(t=>{var j;return t.module===s?{...t,submodules:(j=t.submodules)==null?void 0:j.filter(h=>h.permissions.length>0)}:t}),d.filter(t=>t.permissions.length>0||t.submodules&&t.submodules.length>0)}else return r.map(u=>u.module===s?{...u,submodules:[...u.submodules||[],{module:c,permissions:[l]}]}:u)}else{const n=o.permissions.includes(l);let u=r.map(d=>d.module===s?{...d,permissions:n?d.permissions.filter(t=>t!==l):[...d.permissions,l]}:d);return u=u.filter(d=>d.permissions.length>0),u.filter(d=>d.permissions.length>0||d.submodules&&d.submodules.length>0)}else{const n={module:s,permissions:c?[]:[l]};return c&&(n.submodules=[{module:c,permissions:[l]}]),[...r,n].filter(d=>d.permissions.length>0||d.submodules&&d.submodules.length>0)}})},A=({module:s,submodule:c})=>{const l=S(s,c);b(l?r=>r.filter(o=>o.module!==s):r=>{var o;return[...r,{module:s,permissions:["GET","POST","PUT","DELETE"],submodules:((o=E.find(a=>a.Module===s))==null?void 0:o.SubModules.map(a=>({module:a.SubModule,permissions:["GET","POST","PUT","DELETE"]})))||void 0}]})},I=({module:s,submodule:c})=>{const l=S(s,c);b(l?r=>r.map(o=>{var a;return o.module===s?{...o,submodules:(a=o.submodules)==null?void 0:a.filter(n=>n.module!==c)}:o}):r=>r.find(a=>a.module===s)?r.map(a=>a.module===s?{...a,submodules:[...a.submodules??[],{module:c,permissions:["GET","POST","PUT","DELETE"]}]}:a):[...r,{module:s,permissions:["GET","POST","PUT","DELETE"],submodules:[{module:c,permissions:["GET","POST","PUT","DELETE"]}]}])},W=async()=>{try{x(!0);const s=await _();x(!1),O(s)}catch(s){console.error(s),p("error",s.response.message||"Something went wrong")}};g.useEffect(()=>{W()},[]);const z=async s=>{var o,a;const{title:c,description:l}=s;if(!i){p("error","Please select at least one permission.");return}if(i.length===0){p("error","Please select at least one permission.");return}if(i.filter(n=>n.permissions.length>0||n.submodules&&n.submodules.length>0).length===0){p("error","Please select at least one permission.");return}try{x(!0);const n=await $(c,l,i);n.status===201&&(x(!1),p("success",n.data.message||"Role created successfully"),v("/roles"))}catch(n){console.error(n),x(!1),p("error",((a=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:a.message)||"Something went wrong")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"navigate-wrapper",children:[e.jsx(N,{to:"/roles",className:"link-btn",children:"Role Management"}),e.jsx("span",{children:" / "}),e.jsx("span",{children:"Create New Role"})]}),G&&e.jsx(J,{}),e.jsxs(K,{children:[e.jsx("h2",{className:"page-content-header",children:"Role Details"}),e.jsxs(Q,{onSubmit:R(z),children:[e.jsxs(V,{children:[e.jsxs(C,{md:"4",className:"col-group",children:[e.jsxs(P,{className:"",children:["Role Title ",e.jsx("span",{className:"asterisk",children:"*"})]}),e.jsx(y,{id:"Title",placeholder:"Role Title",invalid:!!f.title,...k("title")}),e.jsx(D,{children:(T=f.title)==null?void 0:T.message})]}),e.jsxs(C,{md:"8",className:"col-group",children:[e.jsxs(P,{children:["Description ",e.jsx("span",{className:"asterisk",children:"*"})]}),e.jsx(y,{id:"Description",placeholder:"Description",invalid:!!f.description,...k("description")}),e.jsx(D,{children:(M=f.description)==null?void 0:M.message})]})]}),e.jsx("h2",{className:"page-content-header",children:"Module Access"}),e.jsx("div",{className:"roaster-main-table w-100 role-management-table",children:e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Module"}),e.jsx("th",{children:"GET"}),e.jsx("th",{children:"POST"}),e.jsx("th",{children:"PUT"}),e.jsx("th",{children:"DELETE"})]})}),e.jsx("tbody",{children:E.map((s,c)=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsxs("td",{colSpan:5,style:{display:"flex",alignItems:"center",flexDirection:"row",gap:"0.25rem"},children:[e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onClick:()=>A({module:s.Module,submodule:null}),checked:i.some(l=>l.module===s.Module&&l.permissions.length===4)}),e.jsx("span",{className:"checkmark"})]}),e.jsx("span",{children:w(s.Module)}),s.SubModules.length>0&&e.jsx("img",{onClick:()=>F(l=>l===s.Module?null:s.Module),src:Y,alt:"expand",className:"expand-icon cursor-pointer"})]}),e.jsx("td",{children:e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onChange:()=>m({module:s.Module,submodule:null,permission:"GET"}),checked:i.some(l=>l.module===s.Module&&l.permissions.includes("GET"))}),e.jsx("span",{className:"checkmark"})]})}),e.jsx("td",{children:e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onChange:()=>m({module:s.Module,submodule:null,permission:"POST"}),checked:i.some(l=>l.module===s.Module&&l.permissions.includes("POST"))}),e.jsx("span",{className:"checkmark"})]})}),e.jsx("td",{children:e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onChange:()=>m({module:s.Module,submodule:null,permission:"PUT"}),checked:i.some(l=>l.module===s.Module&&l.permissions.includes("PUT"))}),e.jsx("span",{className:"checkmark"})]})}),e.jsx("td",{children:e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onChange:()=>m({module:s.Module,submodule:null,permission:"DELETE"}),checked:i.some(l=>l.module===s.Module&&l.permissions.includes("DELETE"))}),e.jsx("span",{className:"checkmark"})]})})]},c),U===s.Module&&e.jsx(e.Fragment,{children:s.SubModules.map((l,r)=>e.jsxs("tr",{className:"expandable-tables",children:[e.jsxs("td",{style:{display:"flex",alignItems:"center",flexDirection:"row",gap:"0.25rem",backgroundColor:"#f9f9f9"},children:[e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onChange:()=>I({module:s.Module,submodule:l.SubModule}),checked:i.some(o=>{var a;return o.module===s.Module&&((a=o.submodules)==null?void 0:a.some(n=>n.module===l.SubModule&&n.permissions.length===4))})}),e.jsx("span",{className:"checkmark"})]}),e.jsx("span",{children:w(l.SubModule)})]}),e.jsx("td",{style:{backgroundColor:"#f9f9f9"},children:e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onChange:()=>m({module:s.Module,submodule:l.SubModule,permission:"GET"}),checked:i.some(o=>{var a;return o.module===s.Module&&((a=o.submodules)==null?void 0:a.some(n=>n.module===l.SubModule&&n.permissions.includes("GET")))})}),e.jsx("span",{className:"checkmark"})]})}),e.jsx("td",{style:{backgroundColor:"#f9f9f9"},children:e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onChange:()=>m({module:s.Module,submodule:l.SubModule,permission:"POST"}),checked:i.some(o=>{var a;return o.module===s.Module&&((a=o.submodules)==null?void 0:a.some(n=>n.module===l.SubModule&&n.permissions.includes("POST")))})}),e.jsx("span",{className:"checkmark"})]})}),e.jsx("td",{style:{backgroundColor:"#f9f9f9"},children:e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onChange:()=>m({module:s.Module,submodule:l.SubModule,permission:"PUT"}),checked:i.some(o=>{var a;return o.module===s.Module&&((a=o.submodules)==null?void 0:a.some(n=>n.module===l.SubModule&&n.permissions.includes("PUT")))})}),e.jsx("span",{className:"checkmark"})]})}),e.jsx("td",{style:{backgroundColor:"#f9f9f9"},children:e.jsxs("label",{className:"label-container",children:[e.jsx("input",{type:"checkbox",onChange:()=>m({module:s.Module,submodule:l.SubModule,permission:"DELETE"}),checked:i.some(o=>{var a;return o.module===s.Module&&((a=o.submodules)==null?void 0:a.some(n=>n.module===l.SubModule&&n.permissions.includes("DELETE")))})}),e.jsx("span",{className:"checkmark"})]})})]},r))})]}))})]})}),e.jsxs("div",{className:"btn-wrapper mt-4",children:[e.jsx(L,{className:"primary-btn",children:"Save"}),e.jsx(N,{to:"/roles",children:e.jsx(L,{className:"secondary-btn",children:"Cancel"})})]})]})]})]})};export{le as default};
